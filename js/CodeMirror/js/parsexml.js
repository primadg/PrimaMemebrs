var XMLParser=Editor.Parser=(function(){var e={autoSelfClosers:{br:true,img:true,hr:true,link:true,input:true,meta:true,col:true,frame:true,base:true,area:true},doNotIndent:{pre:true,"!cdata":true}};var f={autoSelfClosers:{},doNotIndent:{"!cdata":true}};var d=e;var c=false;var b=(function(){function g(l,m){var k=l.next();if(k=="<"){if(l.equals("!")){l.next();if(l.equals("[")){if(l.lookAhead("[CDATA[",true)){m(h("xml-cdata","]]>"));return null}else{return"xml-text"}}else{if(l.lookAhead("--",true)){m(h("xml-comment","-->"));return null}else{return"xml-text"}}}else{if(l.equals("?")){l.next();l.nextWhile(matcher(/[\w\._\-]/));m(h("xml-processing","?>"));return"xml-processing"}else{if(l.equals("/")){l.next()}m(j);return"xml-punctuation"}}}else{if(k=="&"){while(!l.endOfLine()){if(l.next()==";"){break}}return"xml-entity"}else{l.nextWhile(matcher(/[^&<\n]/));return"xml-text"}}}function j(l,m){var k=l.next();if(k==">"){m(g);return"xml-punctuation"}else{if(/[?\/]/.test(k)&&l.equals(">")){l.next();m(g);return"xml-punctuation"}else{if(k=="="){return"xml-punctuation"}else{if(/[\'\"]/.test(k)){m(i(k));return null}else{l.nextWhile(matcher(/[^\s\u00a0=<>\"\'\/?]/));return"xml-name"}}}}}function i(k){return function(l,m){while(!l.endOfLine()){if(l.next()==k){m(j);break}}return"xml-attribute"}}function h(l,k){return function(m,n){while(!m.endOfLine()){if(m.lookAhead(k,true)){n(g);break}m.next()}return l}}return function(l,k){return tokenizer(l,k||g)}})();function a(C){var x=b(C);var y=[p];var o=0,B=0;var z=null,m=null;var u,A;function r(G){for(var H=G.length-1;H>=0;H--){y.push(G[H])}}function l(){r(arguments);u=true}function g(){r(arguments);u=false}function v(G){A=G}function n(G){return function(H,I){if(I==G){l()}else{v("xml-error")||l(arguments.callee)}}}function q(H,I){var G=d.doNotIndent.hasOwnProperty(H)||(m&&m.noIndent);m={prev:m,name:H,indent:B,startOfLine:I,noIndent:G}}function E(){m=m.prev}function h(G){return function(H,J){var I=G;if(I&&I.noIndent){return J}if(c&&/<!\[CDATA\[/.test(H)){return 0}if(I&&/^<\//.test(H)){I=I.prev}while(I&&!I.startOfLine){I=I.prev}if(I){return I.indent+indentUnit}else{return 0}}}function p(){return g(j,p)}var k={"xml-text":true,"xml-entity":true,"xml-comment":true,"xml-processing":true};function j(G,H){if(H=="<"){l(F,t,i(o==1))}else{if(H=="</"){l(s,n(">"))}else{if(G=="xml-cdata"){if(!m||m.name!="!cdata"){q("!cdata")}if(/\]\]>$/.test(H)){E()}l()}else{if(k.hasOwnProperty(G)){l()}else{v("xml-error")||l()}}}}}function F(G,H){if(G=="xml-name"){z=H.toLowerCase();v("xml-tagname");l()}else{z=null;g()}}function s(G,H){if(G=="xml-name"&&m&&H.toLowerCase()==m.name){E();v("xml-tagname")}else{v("xml-error")}l()}function i(G){return function(H,I){if(I=="/>"||(I==">"&&d.autoSelfClosers.hasOwnProperty(z))){l()}else{if(I==">"){q(z,G)||l()}else{v("xml-error")||l(arguments.callee)}}}}function t(G){if(G=="xml-name"){v("xml-attname")||l(w,t)}else{g()}}function w(G,H){if(H=="="){l(D)}else{if(H==">"||H=="/>"){g(i)}else{g()}}}function D(G){if(G=="xml-attribute"){l(D)}else{g()}}return{indentation:function(){return B},next:function(){var G=x.next();if(G.style=="whitespace"&&o==0){B=G.value.length}else{o++}if(G.content=="\n"){B=o=0;G.indentation=h(m)}if(G.style=="whitespace"||G.type=="xml-comment"){return G}while(true){u=A=false;y.pop()(G.style,G.content);if(u){if(A){G.style=A}return G}}},copy:function(){var I=y.concat([]),H=x.state,G=m;var J=this;return function(K){y=I.concat([]);o=B=0;m=G;x=b(K,H);return J}}}}return{make:a,electricChars:"/",configure:function(g){if(g.useHTMLKludges!=null){d=g.useHTMLKludges?e:f}if(g.alignCDATA){c=g.alignCDATA}}}})();
